<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Page 3 | Diving</title>
  <meta name="author" content="Zhenchao Wang">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Diving"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Diving" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Diving</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-07-31T16:00:00.000Z"><a href="/2016/08/01/Linux-Static-Router-Handson/">2016-08-01</a></time>
      
      
  
    <h1 class="title"><a href="/2016/08/01/Linux-Static-Router-Handson/">Linux Static Router Handson</a></h1>
  

    </header>
    <div class="entry">
      
        <p>All created with virtualbox:</p>
<ul>
<li>server1 private network —- inet1</li>
<li>server2 private network —- inet2</li>
<li>router with two adapters inet1 and inet2</li>
</ul>
<ol>
<li>Router configuration<br>Virutalbox–network, adapter 1 set to internal network inet1(192.168.2.0)<br>adapter 2 set to internal network inet2(192.168.3.0)</li>
</ol>
<p>edit <code>/etc/network/interfaces</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">auto enp0s3</div><div class="line">iface enp0s3 inet static</div><div class="line">address 192.168.2.1</div><div class="line">netmask 255.255.255.0</div><div class="line"></div><div class="line">auto enp0s8</div><div class="line">iface enp0s8 inet static</div><div class="line">address 192.168.3.1</div><div class="line">netmask 255.255.255.0</div></pre></td></tr></table></figure>
<p>edit <code>/etc/sysctl.conf</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">net.ipv4.ip_forward=1</div></pre></td></tr></table></figure></p>
<p>reboot, and check with command<br><code>cat /proc/sys/net/ipv4/ip_forward</code></p>
<ol>
<li>server1 setup<br>Virutalbox–network, adapter 1 set to internal network inet1(192.168.2.0),<br>edit <code>/etc/network/interfaces</code><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">auto enp0s3</div><div class="line">iface enp0s3 inet static</div><div class="line">address 192.168.2.10</div><div class="line">netmask 255.255.255.0</div><div class="line">gateway 192.168.2.1</div><div class="line"></div><div class="line"><span class="meta">#</span> static route</div><div class="line">up route add -net 192.168.3.0/24 gw 192.168.2.1 dev enp0s3</div></pre></td></tr></table></figure>
</li>
</ol>
<p>reboot</p>
<p>3 server2 setup<br>Virutalbox–network, adapter 1 set to internal network inet2(192.168.3.0)<br>edit <code>/etc/network/interfaces</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">auto enp0s3</div><div class="line">iface enp0s3 inet static</div><div class="line">address 192.168.3.10</div><div class="line">netmask 255.255.255.0</div><div class="line">gateway 192.168.3.1</div><div class="line"></div><div class="line"><span class="meta">#</span> static route</div><div class="line">up route add -net 192.168.2.0/24 gw 192.168.3.1 dev enp0s3</div></pre></td></tr></table></figure></p>
<p>reboot</p>
<ol>
<li>now in server1, ping 192.168.3.10</li>
</ol>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-11-09T16:00:00.000Z"><a href="/2015/11/10/SpringMVC-Introduction/">2015-11-10</a></time>
      
      
  
    <h1 class="title"><a href="/2015/11/10/SpringMVC-Introduction/">Spring MVC Introduction</a></h1>
  

    </header>
    <div class="entry">
      
        <p>As part of training initiative in my company, I hope to unveil the basic workflow of Spring MVC by examing the implemenation code.</p>
<h3 id="Main-Workflow"><a href="#Main-Workflow" class="headerlink" title="Main Workflow"></a>Main Workflow</h3><p><img src="http://docs.spring.io/spring/docs/current/spring-framework-reference/html/images/mvc.png"></p>
<h3 id="Facade-Front-Controller–DispatcherServlet"><a href="#Facade-Front-Controller–DispatcherServlet" class="headerlink" title="Facade/Front Controller–DispatcherServlet"></a>Facade/Front Controller–DispatcherServlet</h3><h4 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>example<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>example<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/example/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="Java-Code"><a href="#Java-Code" class="headerlink" title="Java Code"></a>Java Code</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">DispatcherServlet</span></span>&#123;</div><div class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doDispatch</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		HttpServletRequest processedRequest = request;</div><div class="line">		HandlerExecutionChain mappedHandler = <span class="keyword">null</span>;</div><div class="line">		<span class="keyword">boolean</span> multipartRequestParsed = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">		WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);</div><div class="line"></div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			ModelAndView mv = <span class="keyword">null</span>;</div><div class="line">			Exception dispatchException = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">			<span class="keyword">try</span> &#123;</div><div class="line">				processedRequest = checkMultipart(request);</div><div class="line">				multipartRequestParsed = processedRequest != request;</div><div class="line"></div><div class="line">				<span class="comment">// Determine handler for the current request.</span></div><div class="line">				mappedHandler = getHandler(processedRequest);</div><div class="line">				<span class="keyword">if</span> (mappedHandler == <span class="keyword">null</span> || mappedHandler.getHandler() == <span class="keyword">null</span>) &#123;</div><div class="line">					noHandlerFound(processedRequest, response);</div><div class="line">					<span class="keyword">return</span>;</div><div class="line">				&#125;</div><div class="line"></div><div class="line">				<span class="comment">// Determine handler adapter for the current request.</span></div><div class="line">				HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler());</div><div class="line"></div><div class="line">				<span class="comment">// Process last-modified header, if supported by the handler.</span></div><div class="line">				String method = request.getMethod();</div><div class="line">				<span class="keyword">boolean</span> isGet = <span class="string">"GET"</span>.equals(method);</div><div class="line">				<span class="keyword">if</span> (isGet || <span class="string">"HEAD"</span>.equals(method)) &#123;</div><div class="line">					<span class="keyword">long</span> lastModified = ha.getLastModified(request, mappedHandler.getHandler());</div><div class="line">					<span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</div><div class="line">						logger.debug(<span class="string">"Last-Modified value for ["</span> + getRequestUri(request) + <span class="string">"] is: "</span> + lastModified);</div><div class="line">					&#125;</div><div class="line">					<span class="keyword">if</span> (<span class="keyword">new</span> ServletWebRequest(request, response).checkNotModified(lastModified) &amp;&amp; isGet) &#123;</div><div class="line">						<span class="keyword">return</span>;</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line"></div><div class="line">				<span class="keyword">if</span> (!mappedHandler.applyPreHandle(processedRequest, response)) &#123;</div><div class="line">					<span class="keyword">return</span>;</div><div class="line">				&#125;</div><div class="line"></div><div class="line">				<span class="keyword">try</span> &#123;</div><div class="line">					<span class="comment">// Actually invoke the handler.</span></div><div class="line">					mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</div><div class="line">				&#125;</div><div class="line">				<span class="keyword">finally</span> &#123;</div><div class="line">					<span class="keyword">if</span> (asyncManager.isConcurrentHandlingStarted()) &#123;</div><div class="line">						<span class="keyword">return</span>;</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line"></div><div class="line">				applyDefaultViewName(request, mv);</div><div class="line">				mappedHandler.applyPostHandle(processedRequest, response, mv);</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">catch</span> (Exception ex) &#123;</div><div class="line">				dispatchException = ex;</div><div class="line">			&#125;</div><div class="line">			processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">catch</span> (Exception ex) &#123;</div><div class="line">			triggerAfterCompletion(processedRequest, response, mappedHandler, ex);</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">catch</span> (Error err) &#123;</div><div class="line">			triggerAfterCompletionWithError(processedRequest, response, mappedHandler, err);</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">finally</span> &#123;</div><div class="line">			<span class="keyword">if</span> (asyncManager.isConcurrentHandlingStarted()) &#123;</div><div class="line">				<span class="comment">// Instead of postHandle and afterCompletion</span></div><div class="line">				mappedHandler.applyAfterConcurrentHandlingStarted(processedRequest, response);</div><div class="line">				<span class="keyword">return</span>;</div><div class="line">			&#125;</div><div class="line">			<span class="comment">// Clean up any resources used by a multipart request.</span></div><div class="line">			<span class="keyword">if</span> (multipartRequestParsed) &#123;</div><div class="line">				cleanupMultipart(processedRequest);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Request-to-Controller-Mapping–HandlerMapping-amp-HandlerAdatper"><a href="#Request-to-Controller-Mapping–HandlerMapping-amp-HandlerAdatper" class="headerlink" title="Request to Controller Mapping–HandlerMapping &amp; HandlerAdatper"></a>Request to Controller Mapping–HandlerMapping &amp; HandlerAdatper</h3><h4 id="Flow"><a href="#Flow" class="headerlink" title="Flow"></a>Flow</h4><p><img src="/images/Req_Dispatch.png"></p>
<h4 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Controller</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SamlSPUserController</span> </span>&#123;</div><div class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/user"</span>, method = RequestMethod.GET)</div><div class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">showUserDetails</span><span class="params">()</span> </span>&#123;</div><div class="line">        ModelAndView mv = <span class="keyword">new</span> ModelAndView(<span class="string">"user"</span>);</div><div class="line">        mv.addObject(<span class="string">"principal"</span>, auth.getPrincipal());</div><div class="line">        <span class="keyword">return</span> mv;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Mechanism"><a href="#Mechanism" class="headerlink" title="Mechanism"></a>Mechanism</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">DispatcherServlet</span></span>&#123;</div><div class="line">    <span class="comment">/** List of HandlerMappings used by this servlet */</span></div><div class="line"><span class="keyword">private</span> List&lt;HandlerMapping&gt; handlerMappings;</div><div class="line"><span class="comment">/** List of HandlerAdapters used by this servlet */</span></div><div class="line"><span class="keyword">private</span> List&lt;HandlerAdapter&gt; handlerAdapters;</div><div class="line">...</div><div class="line"><span class="function"><span class="keyword">protected</span> HandlerExecutionChain <span class="title">getHandler</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">	<span class="keyword">for</span> (HandlerMapping hm : <span class="keyword">this</span>.handlerMappings) &#123;</div><div class="line">		<span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</div><div class="line">			logger.trace(</div><div class="line">					<span class="string">"Testing handler map ["</span> + hm + <span class="string">"] in DispatcherServlet with name '"</span> + getServletName() + <span class="string">"'"</span>);</div><div class="line">		&#125;</div><div class="line">		HandlerExecutionChain handler = hm.getHandler(request);</div><div class="line">		<span class="keyword">if</span> (handler != <span class="keyword">null</span>) &#123;</div><div class="line">			<span class="keyword">return</span> handler;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Default"><a href="#Default" class="headerlink" title="Default"></a>Default</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">org.springframework.web.servlet.LocaleResolver=org.springframework.web.servlet.i18n.AcceptHeaderLocaleResolver</div><div class="line"></div><div class="line">org.springframework.web.servlet.ThemeResolver=org.springframework.web.servlet.theme.FixedThemeResolver</div><div class="line"></div><div class="line">org.springframework.web.servlet.HandlerMapping=org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping,\</div><div class="line">	org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping</div><div class="line"></div><div class="line">org.springframework.web.servlet.HandlerAdapter=org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter,\</div><div class="line">	org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter,\</div><div class="line">	org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter</div><div class="line"></div><div class="line">org.springframework.web.servlet.HandlerExceptionResolver=org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerExceptionResolver,\</div><div class="line">	org.springframework.web.servlet.mvc.annotation.ResponseStatusExceptionResolver,\</div><div class="line">	org.springframework.web.servlet.mvc.support.DefaultHandlerExceptionResolver</div><div class="line"></div><div class="line">org.springframework.web.servlet.RequestToViewNameTranslator=org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator</div><div class="line"></div><div class="line">org.springframework.web.servlet.ViewResolver=org.springframework.web.servlet.view.InternalResourceViewResolver</div><div class="line"></div><div class="line">org.springframework.web.servlet.FlashMapManager=org.springframework.web.servlet.support.SessionFlashMapManager</div></pre></td></tr></table></figure>
<h4 id="HandlerAdatper"><a href="#HandlerAdatper" class="headerlink" title="HandlerAdatper"></a>HandlerAdatper</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">HandlerAdapter</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">supports</span><span class="params">(Object handler)</span></span>;</div><div class="line">	<span class="function">ModelAndView <span class="title">handle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception</span>;</div><div class="line">	<span class="function"><span class="keyword">long</span> <span class="title">getLastModified</span><span class="params">(HttpServletRequest request, Object handler)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">DispatcherServlet</span></span>&#123;</div><div class="line">	<span class="function"><span class="keyword">protected</span> HandlerAdapter <span class="title">getHandlerAdapter</span><span class="params">(Object handler)</span> <span class="keyword">throws</span> ServletException </span>&#123;</div><div class="line">		<span class="keyword">for</span> (HandlerAdapter ha : <span class="keyword">this</span>.handlerAdapters) &#123;</div><div class="line">			<span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</div><div class="line">				logger.trace(<span class="string">"Testing handler adapter ["</span> + ha + <span class="string">"]"</span>);</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">if</span> (ha.supports(handler)) &#123;</div><div class="line">				<span class="keyword">return</span> ha;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> ServletException(<span class="string">"No adapter for handler ["</span> + handler +</div><div class="line">				<span class="string">"]: The DispatcherServlet configuration needs to include a HandlerAdapter that supports this handler"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Interceptor-Configuration"><a href="#Interceptor-Configuration" class="headerlink" title="Interceptor Configuration"></a>Interceptor Configuration</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- only apply to resources we really want to monitor, not static stuff .--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/api/**"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/j_spring_security_check"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.schenker.sims.interceptors.MDCLoggingInterceptor"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="HandlerExecutionChain"><a href="#HandlerExecutionChain" class="headerlink" title="HandlerExecutionChain"></a>HandlerExecutionChain</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HandlerExecutionChain</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object handler;</div><div class="line">	<span class="keyword">private</span> HandlerInterceptor[] interceptors;</div><div class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">applyPreHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		<span class="keyword">if</span> (getInterceptors() != <span class="keyword">null</span>) &#123;</div><div class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; getInterceptors().length; i++) &#123;</div><div class="line">				HandlerInterceptor interceptor = getInterceptors()[i];</div><div class="line">				<span class="keyword">if</span> (!interceptor.preHandle(request, response, <span class="keyword">this</span>.handler)) &#123;</div><div class="line">					triggerAfterCompletion(request, response, <span class="keyword">null</span>);</div><div class="line">					<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">				&#125;</div><div class="line">				<span class="keyword">this</span>.interceptorIndex = i;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">applyPostHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, ModelAndView mv)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		<span class="keyword">if</span> (getInterceptors() == <span class="keyword">null</span>) &#123;</div><div class="line">			<span class="keyword">return</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = getInterceptors().length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</div><div class="line">			HandlerInterceptor interceptor = getInterceptors()[i];</div><div class="line">			interceptor.postHandle(request, response, <span class="keyword">this</span>.handler, mv);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">triggerAfterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Exception ex)</span></span></div><div class="line"><span class="function">			<span class="keyword">throws</span> Exception </span>&#123;</div><div class="line"></div><div class="line">		<span class="keyword">if</span> (getInterceptors() == <span class="keyword">null</span>) &#123;</div><div class="line">			<span class="keyword">return</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="keyword">this</span>.interceptorIndex; i &gt;= <span class="number">0</span>; i--) &#123;</div><div class="line">			HandlerInterceptor interceptor = getInterceptors()[i];</div><div class="line">			<span class="keyword">try</span> &#123;</div><div class="line">				interceptor.afterCompletion(request, response, <span class="keyword">this</span>.handler, ex);</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">catch</span> (Throwable ex2) &#123;</div><div class="line">				logger.error(<span class="string">"HandlerInterceptor.afterCompletion threw exception"</span>, ex2);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="HandlerInterceptor"><a href="#HandlerInterceptor" class="headerlink" title="HandlerInterceptor"></a>HandlerInterceptor</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">HandlerInterceptor</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span><span class="keyword">throws</span> Exception</span>;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span><span class="keyword">throws</span> Exception</span>;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span><span class="keyword">throws</span> Exception</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Handling-Request"><a href="#Handling-Request" class="headerlink" title="Handling Request"></a>Handling Request</h3><h4 id="Flow-1"><a href="#Flow-1" class="headerlink" title="Flow"></a>Flow</h4><p><img src="/images/Handle_View.png"></p>
<p><a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/html/mvc.html#mvc-ann-methods" target="_blank" rel="external">Request Mapping Handler Method</a></p>
<p>The first adapter in the adatper chain is <code>RequestMappingHandlerAdapter</code>, let’s focus on that right now.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="comment">// Do this first, it may add ResponseBody advice beans</span></div><div class="line">	initControllerAdviceCache();</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.argumentResolvers == <span class="keyword">null</span>) &#123;</div><div class="line">		List&lt;HandlerMethodArgumentResolver&gt; resolvers = getDefaultArgumentResolvers();</div><div class="line">		<span class="keyword">this</span>.argumentResolvers = <span class="keyword">new</span> HandlerMethodArgumentResolverComposite().addResolvers(resolvers);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.initBinderArgumentResolvers == <span class="keyword">null</span>) &#123;</div><div class="line">		List&lt;HandlerMethodArgumentResolver&gt; resolvers = getDefaultInitBinderArgumentResolvers();</div><div class="line">		<span class="keyword">this</span>.initBinderArgumentResolvers = <span class="keyword">new</span> HandlerMethodArgumentResolverComposite().addResolvers(resolvers);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.returnValueHandlers == <span class="keyword">null</span>) &#123;</div><div class="line">		List&lt;HandlerMethodReturnValueHandler&gt; handlers = getDefaultReturnValueHandlers();</div><div class="line">		<span class="keyword">this</span>.returnValueHandlers = <span class="keyword">new</span> HandlerMethodReturnValueHandlerComposite().addHandlers(handlers);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> ModelAndView <span class="title">invokeHandleMethod</span><span class="params">(HttpServletRequest request,</span></span></div><div class="line"><span class="function"><span class="params">			HttpServletResponse response, HandlerMethod handlerMethod)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line"></div><div class="line">		ServletWebRequest webRequest = <span class="keyword">new</span> ServletWebRequest(request, response);</div><div class="line"></div><div class="line">		WebDataBinderFactory binderFactory = getDataBinderFactory(handlerMethod);</div><div class="line">		ModelFactory modelFactory = getModelFactory(handlerMethod, binderFactory);</div><div class="line">		ServletInvocableHandlerMethod requestMappingMethod = createRequestMappingMethod(handlerMethod, binderFactory);</div><div class="line"></div><div class="line">		ModelAndViewContainer mavContainer = <span class="keyword">new</span> ModelAndViewContainer();</div><div class="line">		mavContainer.addAllAttributes(RequestContextUtils.getInputFlashMap(request));</div><div class="line">		modelFactory.initModel(webRequest, mavContainer, requestMappingMethod);</div><div class="line">		mavContainer.setIgnoreDefaultModelOnRedirect(<span class="keyword">this</span>.ignoreDefaultModelOnRedirect);</div><div class="line"></div><div class="line">		AsyncWebRequest asyncWebRequest = WebAsyncUtils.createAsyncWebRequest(request, response);</div><div class="line">		asyncWebRequest.setTimeout(<span class="keyword">this</span>.asyncRequestTimeout);</div><div class="line"></div><div class="line">		<span class="keyword">final</span> WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);</div><div class="line">		asyncManager.setTaskExecutor(<span class="keyword">this</span>.taskExecutor);</div><div class="line">		asyncManager.setAsyncWebRequest(asyncWebRequest);</div><div class="line">		asyncManager.registerCallableInterceptors(<span class="keyword">this</span>.callableInterceptors);</div><div class="line">		asyncManager.registerDeferredResultInterceptors(<span class="keyword">this</span>.deferredResultInterceptors);</div><div class="line"></div><div class="line">		<span class="keyword">if</span> (asyncManager.hasConcurrentResult()) &#123;</div><div class="line">			Object result = asyncManager.getConcurrentResult();</div><div class="line">			mavContainer = (ModelAndViewContainer) asyncManager.getConcurrentResultContext()[<span class="number">0</span>];</div><div class="line">			asyncManager.clearConcurrentResult();</div><div class="line"></div><div class="line">			<span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</div><div class="line">				logger.debug(<span class="string">"Found concurrent result value ["</span> + result + <span class="string">"]"</span>);</div><div class="line">			&#125;</div><div class="line">			requestMappingMethod = requestMappingMethod.wrapConcurrentResult(result);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		requestMappingMethod.invokeAndHandle(webRequest, mavContainer);</div><div class="line"></div><div class="line">		<span class="keyword">if</span> (asyncManager.isConcurrentHandlingStarted()) &#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="keyword">return</span> getModelAndView(mavContainer, modelFactory, webRequest);</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<p>In short, Spring MVC utilized Java reflection to resolve the handler method paramters, fill/merge annotation attributes from request/session, then do the real method call via reflection again. Any further investigation lead to more insights into the framework.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">invokeAndHandle</span><span class="params">(ServletWebRequest webRequest,</span></span></div><div class="line"><span class="function"><span class="params">		ModelAndViewContainer mavContainer, Object... providedArgs)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line"></div><div class="line">	Object returnValue = invokeForRequest(webRequest, mavContainer, providedArgs);</div><div class="line"></div><div class="line">	setResponseStatus(webRequest);</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (returnValue == <span class="keyword">null</span>) &#123;</div><div class="line">		<span class="keyword">if</span> (isRequestNotModified(webRequest) || hasResponseStatus() || mavContainer.isRequestHandled()) &#123;</div><div class="line">			mavContainer.setRequestHandled(<span class="keyword">true</span>);</div><div class="line">			<span class="keyword">return</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (StringUtils.hasText(<span class="keyword">this</span>.responseReason)) &#123;</div><div class="line">		mavContainer.setRequestHandled(<span class="keyword">true</span>);</div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	mavContainer.setRequestHandled(<span class="keyword">false</span>);</div><div class="line"></div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">		<span class="keyword">this</span>.returnValueHandlers.handleReturnValue(returnValue, getReturnValueType(returnValue), mavContainer, webRequest);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">catch</span> (Exception ex) &#123;</div><div class="line">		<span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</div><div class="line">			logger.trace(getReturnValueHandlingErrorMessage(<span class="string">"Error handling return value"</span>, returnValue), ex);</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">throw</span> ex;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="ModelAndView-Processing"><a href="#ModelAndView-Processing" class="headerlink" title="ModelAndView Processing"></a>ModelAndView Processing</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">processDispatchResult</span><span class="params">(HttpServletRequest request, HttpServletResponse response,</span></span></div><div class="line"><span class="function"><span class="params">			HandlerExecutionChain mappedHandler, ModelAndView mv, Exception exception)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line"></div><div class="line">		<span class="keyword">boolean</span> errorView = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">		<span class="keyword">if</span> (exception != <span class="keyword">null</span>) &#123;</div><div class="line">			<span class="keyword">if</span> (exception <span class="keyword">instanceof</span> ModelAndViewDefiningException) &#123;</div><div class="line">				logger.debug(<span class="string">"ModelAndViewDefiningException encountered"</span>, exception);</div><div class="line">				mv = ((ModelAndViewDefiningException) exception).getModelAndView();</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">else</span> &#123;</div><div class="line">				Object handler = (mappedHandler != <span class="keyword">null</span> ? mappedHandler.getHandler() : <span class="keyword">null</span>);</div><div class="line">				mv = processHandlerException(request, response, handler, exception);</div><div class="line">				errorView = (mv != <span class="keyword">null</span>);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="comment">// Did the handler return a view to render?</span></div><div class="line">		<span class="keyword">if</span> (mv != <span class="keyword">null</span> &amp;&amp; !mv.wasCleared()) &#123;</div><div class="line">			render(mv, request, response);</div><div class="line">			<span class="keyword">if</span> (errorView) &#123;</div><div class="line">				WebUtils.clearErrorRequestAttributes(request);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">else</span> &#123;</div><div class="line">			<span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</div><div class="line">				logger.debug(<span class="string">"Null ModelAndView returned to DispatcherServlet with name '"</span> + getServletName() +</div><div class="line">						<span class="string">"': assuming HandlerAdapter completed request handling"</span>);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="keyword">if</span> (WebAsyncUtils.getAsyncManager(request).isConcurrentHandlingStarted()) &#123;</div><div class="line">			<span class="comment">// Concurrent handling started during a forward</span></div><div class="line">			<span class="keyword">return</span>;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="keyword">if</span> (mappedHandler != <span class="keyword">null</span>) &#123;</div><div class="line">			mappedHandler.triggerAfterCompletion(request, response, <span class="keyword">null</span>);</div><div class="line">		&#125;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<h3 id="View-Resolution"><a href="#View-Resolution" class="headerlink" title="View Resolution"></a>View Resolution</h3><p><code>DispatcherServlet</code> renders the view to <code>InternalView</code>.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">render</span><span class="params">(ModelAndView mv, HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		<span class="comment">// Determine locale for request and apply it to the response.</span></div><div class="line">		Locale locale = <span class="keyword">this</span>.localeResolver.resolveLocale(request);</div><div class="line">		response.setLocale(locale);</div><div class="line"></div><div class="line">		View view;</div><div class="line">		<span class="keyword">if</span> (mv.isReference()) &#123;</div><div class="line">			<span class="comment">// We need to resolve the view name.</span></div><div class="line">			view = resolveViewName(mv.getViewName(), mv.getModelInternal(), locale, request);</div><div class="line">			<span class="keyword">if</span> (view == <span class="keyword">null</span>) &#123;</div><div class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> ServletException(<span class="string">"Could not resolve view with name '"</span> + mv.getViewName() +</div><div class="line">						<span class="string">"' in servlet with name '"</span> + getServletName() + <span class="string">"'"</span>);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">else</span> &#123;</div><div class="line">			<span class="comment">// No need to lookup: the ModelAndView object contains the actual View object.</span></div><div class="line">			view = mv.getView();</div><div class="line">			<span class="keyword">if</span> (view == <span class="keyword">null</span>) &#123;</div><div class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> ServletException(<span class="string">"ModelAndView ["</span> + mv + <span class="string">"] neither contains a view name nor a "</span> +</div><div class="line">						<span class="string">"View object in servlet with name '"</span> + getServletName() + <span class="string">"'"</span>);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="comment">// Delegate to the View object for rendering.</span></div><div class="line">		<span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</div><div class="line">			logger.debug(<span class="string">"Rendering view ["</span> + view + <span class="string">"] in DispatcherServlet with name '"</span> + getServletName() + <span class="string">"'"</span>);</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			view.render(mv.getModelInternal(), request, response);</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">catch</span> (Exception ex) &#123;</div><div class="line">			<span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</div><div class="line">				logger.debug(<span class="string">"Error rendering view ["</span> + view + <span class="string">"] in DispatcherServlet with name '"</span> +</div><div class="line">						getServletName() + <span class="string">"'"</span>, ex);</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">throw</span> ex;</div><div class="line">		&#125;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> View <span class="title">resolveViewName</span><span class="params">(String viewName, Map&lt;String, Object&gt; model, Locale locale,</span></span></div><div class="line"><span class="function"><span class="params">		HttpServletRequest request)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">for</span> (ViewResolver viewResolver : <span class="keyword">this</span>.viewResolvers) &#123;</div><div class="line">		View view = viewResolver.resolveViewName(viewName, locale);</div><div class="line">		<span class="keyword">if</span> (view != <span class="keyword">null</span>) &#123;</div><div class="line">			<span class="keyword">return</span> view;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>InternalViewResolver</code> is the only ViewResolver configed by default and resolve it to <code>InternalView</code>, or <code>JstlView</code> if jstl library is on the classpath.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> AbstractUrlBasedView <span class="title">buildView</span><span class="params">(String viewName)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">	InternalResourceView view = (InternalResourceView) <span class="keyword">super</span>.buildView(viewName);</div><div class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.alwaysInclude != <span class="keyword">null</span>) &#123;</div><div class="line">		view.setAlwaysInclude(<span class="keyword">this</span>.alwaysInclude);</div><div class="line">	&#125;</div><div class="line">	view.setPreventDispatchLoop(<span class="keyword">true</span>);</div><div class="line">	<span class="keyword">return</span> view;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>This is what superclass UrlBasedViewResolver does<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> AbstractUrlBasedView <span class="title">buildView</span><span class="params">(String viewName)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		AbstractUrlBasedView view = (AbstractUrlBasedView) BeanUtils.instantiateClass(getViewClass());</div><div class="line">		view.setUrl(getPrefix() + viewName + getSuffix());</div><div class="line"></div><div class="line">		String contentType = getContentType();</div><div class="line">		<span class="keyword">if</span> (contentType != <span class="keyword">null</span>) &#123;</div><div class="line">			view.setContentType(contentType);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		view.setRequestContextAttribute(getRequestContextAttribute());</div><div class="line">		view.setAttributesMap(getAttributesMap());</div><div class="line"></div><div class="line">		Boolean exposePathVariables = getExposePathVariables();</div><div class="line">		<span class="keyword">if</span> (exposePathVariables != <span class="keyword">null</span>) &#123;</div><div class="line">			view.setExposePathVariables(exposePathVariables);</div><div class="line">		&#125;</div><div class="line">		Boolean exposeContextBeansAsAttributes = getExposeContextBeansAsAttributes();</div><div class="line">		<span class="keyword">if</span> (exposeContextBeansAsAttributes != <span class="keyword">null</span>) &#123;</div><div class="line">			view.setExposeContextBeansAsAttributes(exposeContextBeansAsAttributes);</div><div class="line">		&#125;</div><div class="line">		String[] exposedContextBeanNames = getExposedContextBeanNames();</div><div class="line">		<span class="keyword">if</span> (exposedContextBeanNames != <span class="keyword">null</span>) &#123;</div><div class="line">			view.setExposedContextBeanNames(exposedContextBeanNames);</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> view;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<h3 id="View-Render"><a href="#View-Render" class="headerlink" title="View Render"></a>View Render</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">InternalResourceView</span></span>&#123;</div><div class="line"><span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">renderMergedOutputModel</span><span class="params">(</span></span></div><div class="line"><span class="function"><span class="params">			Map&lt;String, Object&gt; model, HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line"></div><div class="line">		<span class="comment">// Expose the model object as request attributes.</span></div><div class="line">		exposeModelAsRequestAttributes(model, request);</div><div class="line"></div><div class="line">		<span class="comment">// Expose helpers as request attributes, if any.</span></div><div class="line">		exposeHelpers(request);</div><div class="line"></div><div class="line">		<span class="comment">// Determine the path for the request dispatcher.</span></div><div class="line">		String dispatcherPath = prepareForRendering(request, response);</div><div class="line"></div><div class="line">		<span class="comment">// Obtain a RequestDispatcher for the target resource (typically a JSP).</span></div><div class="line">		RequestDispatcher rd = getRequestDispatcher(request, dispatcherPath);</div><div class="line">		<span class="keyword">if</span> (rd == <span class="keyword">null</span>) &#123;</div><div class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> ServletException(<span class="string">"Could not get RequestDispatcher for ["</span> + getUrl() +</div><div class="line">					<span class="string">"]: Check that the corresponding file exists within your web application archive!"</span>);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="comment">// If already included or response already committed, perform include, else forward.</span></div><div class="line">		<span class="keyword">if</span> (useInclude(request, response)) &#123;</div><div class="line">			response.setContentType(getContentType());</div><div class="line">			<span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</div><div class="line">				logger.debug(<span class="string">"Including resource ["</span> + getUrl() + <span class="string">"] in InternalResourceView '"</span> + getBeanName() + <span class="string">"'"</span>);</div><div class="line">			&#125;</div><div class="line">			rd.include(request, response);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="keyword">else</span> &#123;</div><div class="line">			<span class="comment">// Note: The forwarded resource is supposed to determine the content type itself.</span></div><div class="line">			<span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</div><div class="line">				logger.debug(<span class="string">"Forwarding to resource ["</span> + getUrl() + <span class="string">"] in InternalResourceView '"</span> + getBeanName() + <span class="string">"'"</span>);</div><div class="line">			&#125;</div><div class="line">			rd.forward(request, response);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Restful-client"><a href="#Restful-client" class="headerlink" title="Restful client"></a>Restful client</h3><h4 id="Configuraton"><a href="#Configuraton" class="headerlink" title="Configuraton"></a>Configuraton</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(value = REST_SIGN_IN_URL, method = RequestMethod.POST)</div><div class="line"><span class="meta">@ResponseBody</span></div><div class="line"><span class="function"><span class="keyword">public</span> MapResponse <span class="title">authenticate</span><span class="params">(@RequestBody Map&lt;String, String&gt; request)</span> </span>&#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Add dependency for any json library, e.g.<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jackson.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>Study <code>RequestResponseBodyMethodProcessor</code> if you are interested.</p>
<h3 id="Exception-Handling"><a href="#Exception-Handling" class="headerlink" title="Exception Handling"></a>Exception Handling</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initHandlerExceptionResolvers</span><span class="params">(ApplicationContext context)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.handlerExceptionResolvers = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.detectAllHandlerExceptionResolvers) &#123;</div><div class="line">			<span class="comment">// Find all HandlerExceptionResolvers in the ApplicationContext, including ancestor contexts.</span></div><div class="line">			Map&lt;String, HandlerExceptionResolver&gt; matchingBeans = BeanFactoryUtils</div><div class="line">					.beansOfTypeIncludingAncestors(context, HandlerExceptionResolver.class, <span class="keyword">true</span>, <span class="keyword">false</span>);</div><div class="line">			<span class="keyword">if</span> (!matchingBeans.isEmpty()) &#123;</div><div class="line">				<span class="keyword">this</span>.handlerExceptionResolvers = <span class="keyword">new</span> ArrayList&lt;HandlerExceptionResolver&gt;(matchingBeans.values());</div><div class="line">				<span class="comment">// We keep HandlerExceptionResolvers in sorted order.</span></div><div class="line">				OrderComparator.sort(<span class="keyword">this</span>.handlerExceptionResolvers);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">else</span> &#123;</div><div class="line">			<span class="keyword">try</span> &#123;</div><div class="line">				HandlerExceptionResolver her =</div><div class="line">						context.getBean(HANDLER_EXCEPTION_RESOLVER_BEAN_NAME, HandlerExceptionResolver.class);</div><div class="line">				<span class="keyword">this</span>.handlerExceptionResolvers = Collections.singletonList(her);</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">catch</span> (NoSuchBeanDefinitionException ex) &#123;</div><div class="line">				<span class="comment">// Ignore, no HandlerExceptionResolver is fine too.</span></div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="comment">// Ensure we have at least some HandlerExceptionResolvers, by registering</span></div><div class="line">		<span class="comment">// default HandlerExceptionResolvers if no other resolvers are found.</span></div><div class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.handlerExceptionResolvers == <span class="keyword">null</span>) &#123;</div><div class="line">			<span class="keyword">this</span>.handlerExceptionResolvers = getDefaultStrategies(context, HandlerExceptionResolver.class);</div><div class="line">			<span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</div><div class="line">				logger.debug(<span class="string">"No HandlerExceptionResolvers found in servlet '"</span> + getServletName() + <span class="string">"': using default"</span>);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">HandlerExceptionResolver</span> </span>&#123;</div><div class="line">	<span class="function">ModelAndView <span class="title">resolveException</span><span class="params">(</span></span></div><div class="line"><span class="function"><span class="params">			HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span></span>;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Follow <a href="http://spring.io/blog/2013/11/01/exception-handling-in-spring-mvc" target="_blank" rel="external">Spring MVC Exception Handling</a> for details</p>
<h3 id="Excersies"><a href="#Excersies" class="headerlink" title="Excersies"></a>Excersies</h3><h4 id="1-Study-Spring-Showcase"><a href="#1-Study-Spring-Showcase" class="headerlink" title="1. Study Spring Showcase"></a>1. Study <a href="https://github.com/spring-projects/spring-mvc-showcase" target="_blank" rel="external">Spring Showcase</a></h4><h4 id="2-Track-how-modelAndView-is-constructed-all-the-way-This-is-a-challenger-but-you-knows-the-framework-better-once-you-manged-to-complete-this"><a href="#2-Track-how-modelAndView-is-constructed-all-the-way-This-is-a-challenger-but-you-knows-the-framework-better-once-you-manged-to-complete-this" class="headerlink" title="2. Track how modelAndView is constructed all the way(This is a challenger, but you knows the framework better once you manged to complete this)"></a>2. Track how modelAndView is constructed all the way(This is a challenger, but you knows the framework better once you manged to complete this)</h4>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-10-07T16:00:00.000Z"><a href="/2015/10/08/Wsimport-Binding-Configuration/">2015-10-08</a></time>
      
      
  
    <h1 class="title"><a href="/2015/10/08/Wsimport-Binding-Configuration/">Wsimport Binding Configuration</a></h1>
  

    </header>
    <div class="entry">
      
        <p>In the example below, I wanted to customize the package name and exception name via some configuration in my maven pom file.<br>First, we need to add the jaxws-maven-plugin, and config executions to generate code based on the provided wsdl file:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- let's start with the nasty jaxws stuff first. Run with:</span></div><div class="line"><span class="comment">            mvn clean generate-sources</span></div><div class="line"><span class="comment">    --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- org.codehaus.mojo 1.12 deprecated --&gt;</span></div><div class="line">        <span class="comment">&lt;!-- also checkout newer version from different group:id org.jvnet.jax-ws-commons version 2.3 --&gt;</span></div><div class="line">        <span class="comment">&lt;!-- Service Constructor Problem: http://stackoverflow.com/questions/6947451/maven-using-jax-ws-2-1-instead-of-jax-ws-2-2 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jvnet.jax-ws-commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jaxws-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jaxws-maven-plugin.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">            <span class="comment">&lt;!-- conflict&lt;packageName&gt;com.eric.simsclient&lt;/packageName&gt;    		      --&gt;</span></div><div class="line">            <span class="comment">&lt;!--  http://mojo.codehaus.org/jaxws-maven-plugin/wsimport-mojo.html  --&gt;</span></div><div class="line">            <span class="comment">&lt;!-- mojo plugin usefull uses jaxws/wsimport/java but we prefer the one from</span></div><div class="line"><span class="comment">               https://jax-ws-commons.java.net/jaxws-maven-plugin/wsimport-mojo.html (which will be also picked up by IntelliJ --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">sourceDestDir</span>&gt;</span>$&#123;project.build.directory&#125;/generated-sources/wsimport<span class="tag">&lt;/<span class="name">sourceDestDir</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">wsdlDirectory</span>&gt;</span>$&#123;jaxws.wsdlDirectory&#125;<span class="tag">&lt;/<span class="name">wsdlDirectory</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">bindingDirectory</span>&gt;</span>$&#123;jaxws.bindingDirectory&#125;<span class="tag">&lt;/<span class="name">bindingDirectory</span>&gt;</span></div><div class="line">            <span class="comment">&lt;!-- ATTENTIONS: THIS IS NECESSARY IF USING JDK 1.8 OTHERWHISE WSIMPORTT WILL FAIL --&gt;</span></div><div class="line">            <span class="comment">&lt;!-- https://java.net/jira/browse/JAX_WS_COMMONS-129 --&gt;</span></div><div class="line">            <span class="comment">&lt;!-- http://wiki.netbeans.org/FaqWSDLExternalSchema --&gt;</span></div><div class="line">            <span class="comment">&lt;!-- http://stackoverflow.com/questions/23814921/cannot-use-org-jvnet-jax-ws-commons-jaxws-maven-plugin-on-jdk8 --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">vmArgs</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">vmArg</span>&gt;</span>-Djavax.xml.accessExternalDTD=all<span class="tag">&lt;/<span class="name">vmArg</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">vmArg</span>&gt;</span>-Djavax.xml.accessExternalSchema=all<span class="tag">&lt;/<span class="name">vmArg</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">vmArgs</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!--</span></div><div class="line"><span class="comment">        &lt;bindingFiles&gt;&lt;bindingFile&gt;IdentityManagement-jawxs.xjb&lt;/bindingFile&gt;&lt;bindingFile&gt;IdentityManagement-jaxb.xjb&lt;/bindingFile&gt;&lt;/bindingFiles&gt;</span></div><div class="line"><span class="comment">        --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">executions</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">execution</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">id</span>&gt;</span>AccessManagement<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">phase</span>&gt;</span>generate-sources<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">goals</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">goal</span>&gt;</span>wsimport<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">wsdlFiles</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">wsdlFile</span>&gt;</span>AccessManagement.wsdl<span class="tag">&lt;/<span class="name">wsdlFile</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">wsdlFiles</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">wsdlLocation</span>&gt;</span>$&#123;jaxws.wsdlLocationRoot&#125;/AccessManagement.wsdl<span class="tag">&lt;/<span class="name">wsdlLocation</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">staleFile</span>&gt;</span>$&#123;project.build.directory&#125;/jaxws/stale/AccessManagement.wsdl.done<span class="tag">&lt;/<span class="name">staleFile</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">bindingFiles</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">bindingFile</span>&gt;</span>AccessManagement-jaxb.xjb<span class="tag">&lt;/<span class="name">bindingFile</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">bindingFile</span>&gt;</span>AccessManagement-jaxws.xjb<span class="tag">&lt;/<span class="name">bindingFile</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">bindingFiles</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">executions</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div></pre></td></tr></table></figure>
<p>In the file AccessManagement-jaxb.xjb, the package name is customized on some xpath selected node.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">jaxb:bindings</span></span></div><div class="line"><span class="tag">        <span class="attr">xmlns:jaxb</span>=<span class="string">"http://java.sun.com/xml/ns/jaxb"</span></span></div><div class="line"><span class="tag">        <span class="attr">xmlns:xs</span>=<span class="string">"http://www.w3.org/2001/XMLSchema"</span></span></div><div class="line"><span class="tag">        <span class="attr">version</span>=<span class="string">"1.0"</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--http://stackoverflow.com/questions/6214576/jax-ws-import-and-customizing-package-to-namespace-mapping --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">jaxb:bindings</span> <span class="attr">schemaLocation</span>=<span class="string">"AccessManagement-1.xsd"</span> <span class="attr">node</span>=<span class="string">"//xs:schema[@targetNamespace='http://eric.com/AccessManagement']"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">jaxb:schemaBindings</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">jaxb:package</span> <span class="attr">name</span>=<span class="string">"com.eric.services.accessmgmt"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">jaxb:schemaBindings</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">jaxb:bindings</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!-- as opposed to im services, we have to put access mgmt stuff into a dedicated packages since AM will use a different namespace --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">jaxb:bindings</span> <span class="attr">schemaLocation</span>=<span class="string">"AccessManagement-2.xsd"</span> <span class="attr">node</span>=<span class="string">"//xs:schema[@targetNamespace='http://eric.com/common']"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">jaxb:schemaBindings</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">jaxb:package</span> <span class="attr">name</span>=<span class="string">"com.eric.services.accessmgmt.tos"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">jaxb:schemaBindings</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">jaxb:bindings</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">jaxb:bindings</span>&gt;</span></div></pre></td></tr></table></figure>
<p>In the file AccessManagement-jawxs.xjb, the Exception name is renamed to MyException.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">jaxws:bindings</span> <span class="attr">wsdlLocation</span>=<span class="string">"AccessManagement.wsdl"</span> <span class="attr">xmlns:jaxws</span>=<span class="string">"http://java.sun.com/xml/ns/jaxws"</span> &gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!-- change the generated exception class name [@name='addNumbers'] [@name='AccessManagementPT'] --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">jaxws:bindings</span> <span class="attr">node</span>=<span class="string">"wsdl:definitions/wsdl:portType/wsdl:operation/wsdl:fault[@name='MyException_Exception']"</span> <span class="attr">xmlns:wsdl</span>=<span class="string">"http://schemas.xmlsoap.org/wsdl/"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">jaxws:class</span> <span class="attr">name</span>=<span class="string">"com.schenker.services.accessmgmt.tos.MyException"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">jaxws:javadoc</span>&gt;</span>Exception generated during computation<span class="tag">&lt;/<span class="name">jaxws:javadoc</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">jaxws:class</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">jaxws:bindings</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">jaxws:bindings</span>&gt;</span></div></pre></td></tr></table></figure>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-09-17T16:00:00.000Z"><a href="/2015/09/18/Javascript_Introduction/">2015-09-18</a></time>
      
      
  
    <h1 class="title"><a href="/2015/09/18/Javascript_Introduction/">Javascript Introduction</a></h1>
  

    </header>
    <div class="entry">
      
        <p>The Company asks me to create some training materials for the interns. Here’s what I managed to put together.</p>
<h3 id="Falsy-Values"><a href="#Falsy-Values" class="headerlink" title="Falsy Values"></a>Falsy Values</h3><table>
<thead>
<tr>
<th style="text-align:center">Name</th>
<th style="text-align:center">Type</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">Number</td>
</tr>
<tr>
<td style="text-align:center">NaN</td>
<td style="text-align:center">Number</td>
</tr>
<tr>
<td style="text-align:center">‘’</td>
<td style="text-align:center">String</td>
</tr>
<tr>
<td style="text-align:center">false</td>
<td style="text-align:center">Boolean</td>
</tr>
<tr>
<td style="text-align:center">null</td>
<td style="text-align:center">Object</td>
</tr>
<tr>
<td style="text-align:center">undefined</td>
<td style="text-align:center">Undefined</td>
</tr>
</tbody>
</table>
<h3 id="Scope"><a href="#Scope" class="headerlink" title="Scope"></a>Scope</h3><h4 id="Global-Scope-is-Evil"><a href="#Global-Scope-is-Evil" class="headerlink" title="Global Scope is Evil"></a>Global Scope is Evil</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> msg = <span class="string">"foo"</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">greeting</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  msg = <span class="string">"bar"</span>;<span class="comment">//side effects</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">greeting2</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">"hello "</span> + msg);</div><div class="line">&#125;</div><div class="line">greeting();</div><div class="line">greeting2();<span class="comment">// you never know whether msg had been changed</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>[<span class="string">'greeting'</span>] = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> msg = <span class="string">"bar"</span>; <span class="comment">// declare local variable and initialize to "bar"</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h4 id="Hoisting"><a href="#Hoisting" class="headerlink" title="Hoisting"></a>Hoisting</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</div><div class="line">   <span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span></span>&#123;</div><div class="line">      String s = <span class="string">"blah"</span>;</div><div class="line">      f2();</div><div class="line">      f3();</div><div class="line">      f4(s); <span class="comment">// do something with s;</span></div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> foo = <span class="number">1</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">if</span> (!foo) &#123;</div><div class="line">		<span class="keyword">var</span> foo = <span class="number">10</span>;</div><div class="line">	&#125;</div><div class="line">	alert(foo);</div><div class="line">&#125;</div><div class="line">bar();</div></pre></td></tr></table></figure>
<p><strong>DECLARAION WILL BE HOISTED TO THE TOP, NOT ASSIGNMENT!</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> foo = <span class="number">1</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> foo;</div><div class="line">	<span class="keyword">if</span> (!foo) &#123;</div><div class="line">		foo = <span class="number">10</span>;</div><div class="line">	&#125;</div><div class="line">	alert(foo);</div><div class="line">&#125;</div><div class="line">bar();</div></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">typeof</span> foo);</div><div class="line">	foo(); <span class="comment">// TypeError "foo is not a function"</span></div><div class="line">	bar(); <span class="comment">// "this will run!"</span></div><div class="line">	<span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="comment">// function expression assigned to local variable 'foo'</span></div><div class="line">		alert(<span class="string">"this won't run!"</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123; <span class="comment">// function declaration, given the name 'bar'</span></div><div class="line">		alert(<span class="string">"this will run!"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">test();</div></pre></td></tr></table></figure>
<p><strong>DECLARE YOUR VARIABLES AT THE TOP</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">a, b, c</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> x = <span class="number">1</span>,</div><div class="line">    	bar,</div><div class="line">    	baz = <span class="string">"something"</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h3><p>Phony Arrays &amp; Array Test<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> is_array = <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</div><div class="line"> <span class="keyword">return</span> value &amp;&amp;</div><div class="line"> <span class="keyword">typeof</span> value === <span class="string">'object'</span> &amp;&amp;</div><div class="line"> <span class="keyword">typeof</span> value.length === <span class="string">'number'</span> &amp;&amp;</div><div class="line"> <span class="keyword">typeof</span> value.splice === <span class="string">'function'</span> &amp;&amp;</div><div class="line"> !(value.propertyIsEnumerable(<span class="string">'length'</span>));</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>Length<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> numbers = [<span class="string">'zero'</span>, <span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'shi'</span>, <span class="string">'go'</span>];</div><div class="line">numbers.length; <span class="comment">// 5</span></div><div class="line">numbers[<span class="number">5</span>]; <span class="comment">//undefined, no indexOfBoundExcpetion</span></div></pre></td></tr></table></figure></p>
<p>Stack &amp; Queue<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">numbers.push(<span class="string">'SElem'</span>);</div><div class="line">numbers.pop();</div><div class="line"></div><div class="line">numbers.shift();</div><div class="line">numbers.unshift(<span class="string">'QElem'</span>);</div></pre></td></tr></table></figure></p>
<p>Delete<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">numbers.splice(<span class="number">2</span>,<span class="number">1</span>);</div></pre></td></tr></table></figure></p>
<p>Enumeration<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> i, j;</div><div class="line"><span class="keyword">for</span>(i <span class="keyword">in</span> numbers)&#123;&#125;</div><div class="line"><span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; numbers.length; j++)&#123;&#125;</div></pre></td></tr></table></figure></p>
<h3 id="Object"><a href="#Object" class="headerlink" title="Object"></a>Object</h3><h4 id="Basic-Usage"><a href="#Basic-Usage" class="headerlink" title="Basic Usage"></a>Basic Usage</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> obj = &#123;&#125;;</div><div class="line">obj.nm = <span class="string">'eric'</span>;</div><div class="line">obj.nm;</div><div class="line">obj[<span class="string">'nm'</span>];</div><div class="line"><span class="keyword">var</span> nm = obj.nm || <span class="string">'default val'</span>;</div><div class="line"><span class="keyword">typeof</span> obj.nm;<span class="comment">// string</span></div><div class="line"><span class="keyword">var</span> f;</div><div class="line"><span class="keyword">for</span>(f <span class="keyword">in</span> obj)&#123;&#125;</div><div class="line"><span class="keyword">delete</span> obj.nm;</div></pre></td></tr></table></figure>
<h4 id="Prototype-Chain"><a href="#Prototype-Chain" class="headerlink" title="Prototype Chain"></a>Prototype Chain</h4><p><img src="/images/prototype.jpg"></p>
<p>Basic Idea<br><img src="/images/protocol_chain.png"></p>
<h3 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h3><p>Function are object that can be invoked.</p>
<h4 id="Pass-by-value-or-reference"><a href="#Pass-by-value-or-reference" class="headerlink" title="Pass by value or reference"></a>Pass by value or reference</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">changeStuff</span>(<span class="params">a, b, c</span>)</span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">  a = a * <span class="number">10</span>;</div><div class="line">  b.item = <span class="string">"changed"</span>;</div><div class="line">  c = &#123;<span class="attr">item</span>: <span class="string">"changed"</span>&#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> num = <span class="number">10</span>;</div><div class="line"><span class="keyword">var</span> obj1 = &#123;<span class="attr">item</span>: <span class="string">"unchanged"</span>&#125;;</div><div class="line"><span class="keyword">var</span> obj2 = &#123;<span class="attr">item</span>: <span class="string">"unchanged"</span>&#125;;</div><div class="line"></div><div class="line">changeStuff(num, obj1, obj2);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(num);</div><div class="line"><span class="built_in">console</span>.log(obj1.item);</div><div class="line"><span class="built_in">console</span>.log(obj2.item);</div></pre></td></tr></table></figure>
<h4 id="Liternal"><a href="#Liternal" class="headerlink" title="Liternal"></a>Liternal</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> f = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</div></pre></td></tr></table></figure>
<p>A functional liternal can appear anywhere that an expression can appear.</p>
<h4 id="High-Order-Functions"><a href="#High-Order-Functions" class="headerlink" title="High Order Functions"></a>High Order Functions</h4><ul>
<li>takes one or more functions as arguments</li>
<li>returns a function as its result</li>
</ul>
<h4 id="Hidden-this"><a href="#Hidden-this" class="headerlink" title="Hidden this"></a>Hidden this</h4><p><code>this</code> is the <strong>context</strong> in which the function operates.  Its meaning depends on how the function is invoked.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myObject = &#123;</div><div class="line">     value: <span class="number">0</span>,</div><div class="line">     increment: <span class="function"><span class="keyword">function</span> (<span class="params">inc</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.value += <span class="keyword">typeof</span> inc === <span class="string">'number'</span> ? inc : <span class="number">1</span>;</div><div class="line">     &#125;</div><div class="line">&#125;;</div><div class="line">myObject.increment();</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> value = <span class="number">5</span>;</div><div class="line"><span class="keyword">var</span> myObject = &#123;</div><div class="line">  value : <span class="number">3</span>;</div><div class="line">  double : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">     <span class="keyword">var</span> helper = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">       <span class="keyword">this</span>.value = <span class="keyword">this</span>.value * <span class="number">2</span>;</div><div class="line">     &#125;</div><div class="line">     helper();</div><div class="line">  &#125;;</div><div class="line">&#125;;</div><div class="line">myObject.value; <span class="comment">// :(, value is still 3</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Fruit = <span class="function"><span class="keyword">function</span>(<span class="params">nm</span>)</span>&#123;</div><div class="line">   <span class="keyword">this</span>.name = nm;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> apple = <span class="keyword">new</span> Fruit(<span class="string">'apple'</span>);</div><div class="line"><span class="keyword">var</span> orange = <span class="keyword">new</span> Fruit(<span class="string">'orange'</span>);</div><div class="line">apple.__proto__ == orange.__proto__; <span class="comment">// true</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> i;</div><div class="line">    <span class="keyword">var</span> total = <span class="number">0</span>;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>);</div><div class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="built_in">arguments</span>.length; i++)&#123;</div><div class="line">        total += <span class="built_in">arguments</span>[i]; <span class="comment">//arguments is an object with attribute length</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> total;</div><div class="line">&#125;</div><div class="line">sum.apply(<span class="literal">null</span>, [<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>]);</div></pre></td></tr></table></figure>
<h4 id="Closure"><a href="#Closure" class="headerlink" title="Closure"></a>Closure</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> i;</div><div class="line"><span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)&#123;</div><div class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(i);&#125;, <span class="number">2000</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">for(i = 0; i &lt; 3; i++)&#123;</div><div class="line">  setTimeout(function(k)&#123;</div><div class="line">               return function()&#123;</div><div class="line">                  console.log(k);</div><div class="line">               &#125;</div><div class="line">            &#125;(i)</div><div class="line">            , 2000);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Why Closure?</p>
<p><strong>Encapsulation</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gen1 = &#123;<span class="attr">num</span>: <span class="number">0</span>,</div><div class="line">           getVal: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                      <span class="keyword">return</span> <span class="keyword">this</span>.num++;</div><div class="line">                   &#125;</div><div class="line">           &#125;;</div><div class="line">gen1.getVal();</div><div class="line">gen1.num = <span class="number">42</span>;</div><div class="line">gen1.getVal();<span class="comment">//Oops!</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Generator</span>(<span class="params">num</span>)</span>&#123;</div><div class="line">    <span class="keyword">this</span>.getVal = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> num++;&#125;;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> gen2 = <span class="keyword">new</span> Generator(<span class="number">0</span>);</div><div class="line">gen2.getVal(); <span class="comment">// 0</span></div><div class="line">gen2.num = <span class="number">42</span>;</div><div class="line">gen2.getVal(); <span class="comment">// 1</span></div></pre></td></tr></table></figure></p>
<p><strong>Context Binding</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> obj = &#123;</div><div class="line">  nm : <span class="string">'eric'</span>,</div><div class="line">  callMe: <span class="function"><span class="keyword">function</span>(<span class="params">other</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(other + <span class="string">' greeted:hi,'</span> + <span class="keyword">this</span>.nm);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">setTimeout(obj.callMe, <span class="number">1000</span>);</div><div class="line">setTimeout(obj.callMe.apply(obj, [<span class="string">'bob'</span>]), <span class="number">8000</span>);</div></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">Function</span>.prototype.bind = <span class="function"><span class="keyword">function</span>(<span class="params">targetObj</span>)</span>&#123;</div><div class="line">   <span class="keyword">var</span> method = <span class="keyword">this</span>,</div><div class="line">       slice = <span class="built_in">Array</span>.prototype.slice,</div><div class="line">       args = slice.apply(<span class="built_in">arguments</span>,[<span class="number">1</span>]);</div><div class="line">   <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">       method.apply(targetObj, args);</div><div class="line">   &#125;;</div><div class="line">&#125;;</div><div class="line">setTimeout(obj.callMe.bind(obj, <span class="string">'bob'</span>), <span class="number">3000</span>);</div></pre></td></tr></table></figure>
<h4 id="Prototype-Revisited"><a href="#Prototype-Revisited" class="headerlink" title="Prototype Revisited"></a>Prototype Revisited</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//an elegant example form Javascript: Good Parts</span></div><div class="line"><span class="built_in">Function</span>.prototype.method = <span class="function"><span class="keyword">function</span> (<span class="params">name, func</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.prototype[name]) &#123;</div><div class="line">        <span class="keyword">this</span>.prototype[name] = func;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="built_in">String</span>.method(<span class="string">'trim'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.replace(<span class="regexp">/^\s+|\s+$/g</span>, <span class="string">''</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="Run-to-Complete-amp-Single-Thread-Model"><a href="#Run-to-Complete-amp-Single-Thread-Model" class="headerlink" title="Run to Complete &amp; Single Thread Model"></a>Run to Complete &amp; Single Thread Model</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> result = <span class="literal">false</span>;</div><div class="line"><span class="keyword">var</span> blocker = <span class="literal">true</span>;</div><div class="line"><span class="keyword">var</span> consulted = <span class="literal">false</span>;</div><div class="line"><span class="keyword">while</span>(blocker)&#123;</div><div class="line">    <span class="keyword">if</span>(!consulted)&#123;</div><div class="line">        $http.get(baseUrl+ <span class="string">"/dosth"</span>).success(</div><div class="line">            <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</div><div class="line">                result = data.result;</div><div class="line">                blocker = <span class="literal">false</span>;</div><div class="line">            &#125;</div><div class="line">        ).error(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                $log.debug(<span class="string">"Error from server: "</span> + angular.toJson());</div><div class="line">                blocker = <span class="literal">false</span>;</div><div class="line">            &#125;);</div><div class="line">        consulted = <span class="literal">true</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Simulation<br><img src="/images/js_singleThread.png"></p>
<p>Another Example<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'hello'</span>);</div><div class="line">&#125;</div><div class="line">setTimeout(f, <span class="number">0</span>);</div><div class="line"><span class="built_in">console</span>.log(<span class="string">' world!'</span>);</div></pre></td></tr></table></figure></p>
<h3 id="Debugging"><a href="#Debugging" class="headerlink" title="Debugging"></a>Debugging</h3><p>Open Chrome, Press F12. That’s all, have fun!</p>
<h3 id="Garbage-Collection"><a href="#Garbage-Collection" class="headerlink" title="Garbage Collection"></a>Garbage Collection</h3><h3 id="Brower-Objects"><a href="#Brower-Objects" class="headerlink" title="Brower Objects"></a>Brower Objects</h3><ul>
<li>Window</li>
<li>Screen</li>
<li>Location</li>
<li>Navigation</li>
<li>Timing</li>
<li>Cookie</li>
</ul>
<p><a href="http://www.w3schools.com/js/js_ex_browser.asp" target="_blank" rel="external">Browser Obj</a></p>
<h3 id="Java-amp-Javascript"><a href="#Java-amp-Javascript" class="headerlink" title="Java &amp; Javascript"></a>Java &amp; Javascript</h3><p>Humor</p>
<ul>
<li>Car &amp; Carpet</li>
<li>Ham &amp; Hamster</li>
</ul>
<p>However, Java does have an execute engine for javascript<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> javax.script.*;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EvalScript</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        <span class="comment">// create a script engine manager</span></div><div class="line">        ScriptEngineManager factory = <span class="keyword">new</span> ScriptEngineManager();</div><div class="line">        <span class="comment">// create a JavaScript engine</span></div><div class="line">        ScriptEngine engine = factory.getEngineByName(<span class="string">"JavaScript"</span>);</div><div class="line">        <span class="comment">// evaluate JavaScript code from String</span></div><div class="line">        engine.eval(<span class="string">"print('Hello, World')"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>See <a href="http://docs.oracle.com/javase/7/docs/technotes/guides/scripting/programmer_guide/" target="_blank" rel="external">Javascript Engine</a> for details</p>
<h3 id="Server-Side"><a href="#Server-Side" class="headerlink" title="Server Side"></a>Server Side</h3><p>Javascript has rose to prominence! <a href="https://nodejs.org/en/" target="_blank" rel="external">NodeJs</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-08-28T16:00:00.000Z"><a href="/2015/08/29/Anatomy-of-Spring-Secuirty-Basic-Workflow/">2015-08-29</a></time>
      
      
  
    <h1 class="title"><a href="/2015/08/29/Anatomy-of-Spring-Secuirty-Basic-Workflow/">Anatomy of Spring Security Basic Workflow</a></h1>
  

    </header>
    <div class="entry">
      
        <p>This post is meant to demystify the internals of spring security, you should be able to understand how spring security hooks back to authentication scenario.</p>
<p>By default, spring security maintains a chain of filters under the cover of the general exposed filter “springSecurityFilterChain”.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doFilterInternal</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span></span></div><div class="line"><span class="function">        <span class="keyword">throws</span> IOException, ServletException </span>&#123;</div><div class="line"></div><div class="line">    FirewalledRequest fwRequest = firewall.getFirewalledRequest((HttpServletRequest) request); <span class="comment">//specified &lt;security:intercept-url&gt;</span></div><div class="line">    HttpServletResponse fwResponse = firewall.getFirewalledResponse((HttpServletResponse) response);</div><div class="line"></div><div class="line">    List&lt;Filter&gt; filters = getFilters(fwRequest);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (filters == <span class="keyword">null</span> || filters.size() == <span class="number">0</span>) &#123; <span class="comment">//unproctecd, just get you through</span></div><div class="line">        <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</div><div class="line">            logger.debug(UrlUtils.buildRequestUrl(fwRequest) +</div><div class="line">                    (filters == <span class="keyword">null</span> ? <span class="string">" has no matching filters"</span> : <span class="string">" has an empty filter list"</span>));</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        fwRequest.reset();</div><div class="line"></div><div class="line">        chain.doFilter(fwRequest, fwResponse);</div><div class="line"></div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    VirtualFilterChain vfc = <span class="keyword">new</span> VirtualFilterChain(fwRequest, chain, filters);</div><div class="line">    vfc.doFilter(fwRequest, fwResponse);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>For a complete list of the configured filters by default, please refer to security schema file. In the case of <a href="http://www.springframework.org/schema/security/spring-security-3.2.xsd" target="_blank" rel="external">3.2</a>,<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">xs:simpleType</span> <span class="attr">name</span>=<span class="string">"named-security-filter"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">xs:restriction</span> <span class="attr">base</span>=<span class="string">"xs:token"</span>&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"FIRST"</span>/&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"CHANNEL_FILTER"</span>/&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"SECURITY_CONTEXT_FILTER"</span>/&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"CONCURRENT_SESSION_FILTER"</span>/&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"WEB_ASYNC_MANAGER_FILTER"</span>/&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"HEADERS_FILTER"</span>/&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"CSRF_FILTER"</span>/&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"LOGOUT_FILTER"</span>/&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"X509_FILTER"</span>/&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"PRE_AUTH_FILTER"</span>/&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"CAS_FILTER"</span>/&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"FORM_LOGIN_FILTER"</span>/&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"OPENID_FILTER"</span>/&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"LOGIN_PAGE_FILTER"</span>/&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"DIGEST_AUTH_FILTER"</span>/&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"BASIC_AUTH_FILTER"</span>/&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"REQUEST_CACHE_FILTER"</span>/&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"SERVLET_API_SUPPORT_FILTER"</span>/&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"JAAS_API_SUPPORT_FILTER"</span>/&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"REMEMBER_ME_FILTER"</span>/&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"ANONYMOUS_FILTER"</span>/&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"SESSION_MANAGEMENT_FILTER"</span>/&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"EXCEPTION_TRANSLATION_FILTER"</span>/&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"FILTER_SECURITY_INTERCEPTOR"</span>/&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"SWITCH_USER_FILTER"</span>/&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"LAST"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">xs:restriction</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">xs:simpleType</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>Of course, the chains can be customized. Please refer to <a href="http://docs.spring.io/spring-security/site/docs/3.0.x/reference/security-filter-chain.html" target="_blank" rel="external">spring security doc</a></p>
<p>Here we will stick to the default chains. The class VirtualFilterchain is defined as below,</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">VirtualFilterChain</span> <span class="keyword">implements</span> <span class="title">FilterChain</span> </span>&#123;</div><div class="line">     <span class="keyword">private</span> <span class="keyword">final</span> FilterChain originalChain; <span class="comment">// save the original chain so that can be restored later</span></div><div class="line">     <span class="keyword">private</span> <span class="keyword">final</span> List&lt;Filter&gt; additionalFilters;</div><div class="line">     <span class="keyword">private</span> <span class="keyword">final</span> FirewalledRequest firewalledRequest;</div><div class="line">     <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> size;</div><div class="line">     <span class="keyword">private</span> <span class="keyword">int</span> currentPosition = <span class="number">0</span>;</div><div class="line"></div><div class="line">     <span class="function"><span class="keyword">private</span> <span class="title">VirtualFilterChain</span><span class="params">(FirewalledRequest firewalledRequest, FilterChain chain, List&lt;Filter&gt; additionalFilters)</span> </span>&#123;</div><div class="line">         <span class="keyword">this</span>.originalChain = chain;</div><div class="line">         <span class="keyword">this</span>.additionalFilters = additionalFilters;</div><div class="line">         <span class="keyword">this</span>.size = additionalFilters.size();</div><div class="line">         <span class="keyword">this</span>.firewalledRequest = firewalledRequest;</div><div class="line">     &#125;</div><div class="line"></div><div class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</div><div class="line">         <span class="keyword">if</span> (currentPosition == size) &#123;</div><div class="line">             <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</div><div class="line">                 logger.debug(UrlUtils.buildRequestUrl(firewalledRequest)</div><div class="line">                         + <span class="string">" reached end of additional filter chain; proceeding with original chain"</span>);</div><div class="line">             &#125;</div><div class="line"></div><div class="line">             <span class="comment">// Deactivate path stripping as we exit the security filter chain</span></div><div class="line">             <span class="keyword">this</span>.firewalledRequest.reset();</div><div class="line"></div><div class="line">             originalChain.doFilter(request, response);</div><div class="line">         &#125; <span class="keyword">else</span> &#123;</div><div class="line">             currentPosition++;</div><div class="line"></div><div class="line">             Filter nextFilter = additionalFilters.get(currentPosition - <span class="number">1</span>);</div><div class="line"></div><div class="line">             <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</div><div class="line">                 logger.debug(UrlUtils.buildRequestUrl(firewalledRequest) + <span class="string">" at position "</span> + currentPosition + <span class="string">" of "</span></div><div class="line">                     + size + <span class="string">" in additional filter chain; firing Filter: '"</span></div><div class="line">                     + nextFilter.getClass().getSimpleName() + <span class="string">"'"</span>);</div><div class="line">             &#125;</div><div class="line"></div><div class="line">             nextFilter.doFilter(request, response, <span class="keyword">this</span>);</div><div class="line">         &#125;</div><div class="line">     &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>Now let’s walk through the protection mechanism of spring security.</p>
<p><img src="/images/spring_security.png" alt=""></p>
<p>Steps explained, skipping some filters for simplicity:</p>
<ol>
<li><p>User attempts to access a protected resource, security context persistence filter mainly restores the securitycontext it saved before and clears the security context when the request processing is completed. Does SecurityContextHolder<br>sound similar to thread-local object? Right. It’s threadlocal by default, which makes sense in typical web app. It’s customizable for spring always grants you the opportunity to substitute the default behavior.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest req, ServletResponse res, FilterChain chain)</span></span></div><div class="line"><span class="function">        <span class="keyword">throws</span> IOException, ServletException </span>&#123;</div><div class="line">    HttpServletRequest request = (HttpServletRequest) req;</div><div class="line">    HttpServletResponse response = (HttpServletResponse) res;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (request.getAttribute(FILTER_APPLIED) != <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="comment">// ensure that filter is only applied once per request</span></div><div class="line">        chain.doFilter(request, response);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">final</span> <span class="keyword">boolean</span> debug = logger.isDebugEnabled();</div><div class="line"></div><div class="line">    request.setAttribute(FILTER_APPLIED, Boolean.TRUE);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (forceEagerSessionCreation) &#123;</div><div class="line">        HttpSession session = request.getSession();</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (debug &amp;&amp; session.isNew()) &#123;</div><div class="line">            logger.debug(<span class="string">"Eagerly created session: "</span> + session.getId());</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    HttpRequestResponseHolder holder = <span class="keyword">new</span> HttpRequestResponseHolder(request, response);</div><div class="line">    SecurityContext contextBeforeChainExecution = repo.loadContext(holder);</div><div class="line"></div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        SecurityContextHolder.setContext(contextBeforeChainExecution);</div><div class="line"></div><div class="line">        chain.doFilter(holder.getRequest(), holder.getResponse());</div><div class="line"></div><div class="line">    &#125; <span class="keyword">finally</span> &#123;</div><div class="line">        SecurityContext contextAfterChainExecution = SecurityContextHolder.getContext();</div><div class="line">        <span class="comment">// Crucial removal of SecurityContextHolder contents - do this before anything else.</span></div><div class="line">        SecurityContextHolder.clearContext();</div><div class="line">        repo.saveContext(contextAfterChainExecution, holder.getRequest(), holder.getResponse());</div><div class="line">        request.removeAttribute(FILTER_APPLIED);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (debug) &#123;</div><div class="line">            logger.debug(<span class="string">"SecurityContextHolder now cleared, as request processing completed"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>If unspecified, the requested URL doesn’t match any filter pattern. Let’s examine what happens when it hits <strong>ANONYMOUS_FILTER</strong>,</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest req, ServletResponse res, FilterChain chain)</span></span></div><div class="line"><span class="function">        <span class="keyword">throws</span> IOException, ServletException </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (applyAnonymousForThisRequest((HttpServletRequest) req)) &#123;</div><div class="line">        <span class="keyword">if</span> (SecurityContextHolder.getContext().getAuthentication() == <span class="keyword">null</span>) &#123;</div><div class="line">            SecurityContextHolder.getContext().setAuthentication(createAuthentication((HttpServletRequest) req));</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</div><div class="line">                logger.debug(<span class="string">"Populated SecurityContextHolder with anonymous token: '"</span></div><div class="line">                    + SecurityContextHolder.getContext().getAuthentication() + <span class="string">"'"</span>);</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</div><div class="line">                logger.debug(<span class="string">"SecurityContextHolder not populated with anonymous token, as it already contained: '"</span></div><div class="line">                    + SecurityContextHolder.getContext().getAuthentication() + <span class="string">"'"</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    chain.doFilter(req, res);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">protected</span> Authentication <span class="title">createAuthentication</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</div><div class="line">    AnonymousAuthenticationToken auth = <span class="keyword">new</span> AnonymousAuthenticationToken(key, principal, authorities);</div><div class="line">    auth.setDetails(authenticationDetailsSource.buildDetails(request));</div><div class="line"></div><div class="line">    <span class="keyword">return</span> auth;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Yes, this filter creates one AnonymousAuthenticationToken with role “ROLE_ANONYMOUS”.</p>
</li>
<li><p>When filter chain execution reaches <strong>FILTER_SECURITY_INTERCEPTOR</strong>, the validation magic finally kicks off.</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span></span></div><div class="line"><span class="function">         <span class="keyword">throws</span> IOException, ServletException </span>&#123;</div><div class="line">     FilterInvocation fi = <span class="keyword">new</span> FilterInvocation(request, response, chain);</div><div class="line">     invoke(fi);</div><div class="line"> &#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invoke</span><span class="params">(FilterInvocation fi)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</div><div class="line">     <span class="keyword">if</span> ((fi.getRequest() != <span class="keyword">null</span>) &amp;&amp; (fi.getRequest().getAttribute(FILTER_APPLIED) != <span class="keyword">null</span>)</div><div class="line">             &amp;&amp; observeOncePerRequest) &#123;</div><div class="line">         <span class="comment">// filter already applied to this request and user wants us to observe</span></div><div class="line">         <span class="comment">// once-per-request handling, so don't re-do security checking</span></div><div class="line">         fi.getChain().doFilter(fi.getRequest(), fi.getResponse());</div><div class="line">     &#125; <span class="keyword">else</span> &#123;</div><div class="line">         <span class="comment">// first time this request being called, so perform security checking</span></div><div class="line">         <span class="keyword">if</span> (fi.getRequest() != <span class="keyword">null</span>) &#123;</div><div class="line">             fi.getRequest().setAttribute(FILTER_APPLIED, Boolean.TRUE);</div><div class="line">         &#125;</div><div class="line"></div><div class="line">         InterceptorStatusToken token = <span class="keyword">super</span>.beforeInvocation(fi); <span class="comment">//unauthorized request won't make it here</span></div><div class="line"></div><div class="line">         <span class="keyword">try</span> &#123;</div><div class="line">             fi.getChain().doFilter(fi.getRequest(), fi.getResponse());</div><div class="line">         &#125; <span class="keyword">finally</span> &#123;</div><div class="line">             <span class="keyword">super</span>.finallyInvocation(token);</div><div class="line">         &#125;</div><div class="line"></div><div class="line">         <span class="keyword">super</span>.afterInvocation(token, <span class="keyword">null</span>);</div><div class="line">     &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p> Unauthorized requests won’t survive the line <code>InterceptorStatusToken token = super.beforeInvocation(fi);</code>, all authentication/authorization decisions are made there.</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> InterceptorStatusToken <span class="title">beforeInvocation</span><span class="params">(Object object)</span> </span>&#123;</div><div class="line">     Assert.notNull(object, <span class="string">"Object was null"</span>);</div><div class="line">     <span class="keyword">final</span> <span class="keyword">boolean</span> debug = logger.isDebugEnabled();</div><div class="line"></div><div class="line">     <span class="keyword">if</span> (!getSecureObjectClass().isAssignableFrom(object.getClass())) &#123;</div><div class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Security invocation attempted for object "</span></div><div class="line">                 + object.getClass().getName()</div><div class="line">                 + <span class="string">" but AbstractSecurityInterceptor only configured to support secure objects of type: "</span></div><div class="line">                 + getSecureObjectClass());</div><div class="line">     &#125;</div><div class="line"></div><div class="line">     Collection&lt;ConfigAttribute&gt; attributes = <span class="keyword">this</span>.obtainSecurityMetadataSource().getAttributes(object);</div><div class="line"></div><div class="line">     <span class="keyword">if</span> (attributes == <span class="keyword">null</span> || attributes.isEmpty()) &#123;</div><div class="line">         <span class="keyword">if</span> (rejectPublicInvocations) &#123;</div><div class="line">             <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Secure object invocation "</span> + object +</div><div class="line">                     <span class="string">" was denied as public invocations are not allowed via this interceptor. "</span></div><div class="line">                             + <span class="string">"This indicates a configuration error because the "</span></div><div class="line">                             + <span class="string">"rejectPublicInvocations property is set to 'true'"</span>);</div><div class="line">         &#125;</div><div class="line"></div><div class="line">         <span class="keyword">if</span> (debug) &#123;</div><div class="line">             logger.debug(<span class="string">"Public object - authentication not attempted"</span>);</div><div class="line">         &#125;</div><div class="line"></div><div class="line">         publishEvent(<span class="keyword">new</span> PublicInvocationEvent(object));</div><div class="line"></div><div class="line">         <span class="keyword">return</span> <span class="keyword">null</span>; <span class="comment">// no further work post-invocation</span></div><div class="line">     &#125;</div><div class="line"></div><div class="line">     <span class="keyword">if</span> (debug) &#123;</div><div class="line">         logger.debug(<span class="string">"Secure object: "</span> + object + <span class="string">"; Attributes: "</span> + attributes);</div><div class="line">     &#125;</div><div class="line"></div><div class="line">     <span class="keyword">if</span> (SecurityContextHolder.getContext().getAuthentication() == <span class="keyword">null</span>) &#123;</div><div class="line">         credentialsNotFound(messages.getMessage(<span class="string">"AbstractSecurityInterceptor.authenticationNotFound"</span>,</div><div class="line">                 <span class="string">"An Authentication object was not found in the SecurityContext"</span>), object, attributes);</div><div class="line">     &#125;</div><div class="line"></div><div class="line">     Authentication authenticated = authenticateIfRequired();</div><div class="line"></div><div class="line">     <span class="comment">// Attempt authorization</span></div><div class="line">     <span class="keyword">try</span> &#123;</div><div class="line">         <span class="keyword">this</span>.accessDecisionManager.decide(authenticated, object, attributes);</div><div class="line">     &#125;</div><div class="line">     <span class="keyword">catch</span> (AccessDeniedException accessDeniedException) &#123;</div><div class="line">         publishEvent(<span class="keyword">new</span> AuthorizationFailureEvent(object, attributes, authenticated, accessDeniedException));</div><div class="line"></div><div class="line">         <span class="keyword">throw</span> accessDeniedException;</div><div class="line">     &#125;</div><div class="line"></div><div class="line">     <span class="keyword">if</span> (debug) &#123;</div><div class="line">         logger.debug(<span class="string">"Authorization successful"</span>);</div><div class="line">     &#125;</div><div class="line"></div><div class="line">     <span class="keyword">if</span> (publishAuthorizationSuccess) &#123;</div><div class="line">         publishEvent(<span class="keyword">new</span> AuthorizedEvent(object, attributes, authenticated));</div><div class="line">     &#125;</div><div class="line"></div><div class="line">     <span class="comment">// Attempt to run as a different user</span></div><div class="line">     Authentication runAs = <span class="keyword">this</span>.runAsManager.buildRunAs(authenticated, object, attributes);</div><div class="line"></div><div class="line">     <span class="keyword">if</span> (runAs == <span class="keyword">null</span>) &#123;</div><div class="line">         <span class="keyword">if</span> (debug) &#123;</div><div class="line">             logger.debug(<span class="string">"RunAsManager did not change Authentication object"</span>);</div><div class="line">         &#125;</div><div class="line"></div><div class="line">         <span class="comment">// no further work post-invocation</span></div><div class="line">         <span class="keyword">return</span> <span class="keyword">new</span> InterceptorStatusToken(SecurityContextHolder.getContext(), <span class="keyword">false</span>, attributes, object);</div><div class="line">     &#125; <span class="keyword">else</span> &#123;</div><div class="line">         <span class="keyword">if</span> (debug) &#123;</div><div class="line">             logger.debug(<span class="string">"Switching to RunAs Authentication: "</span> + runAs);</div><div class="line">         &#125;</div><div class="line"></div><div class="line">         SecurityContext origCtx = SecurityContextHolder.getContext();</div><div class="line">         SecurityContextHolder.setContext(SecurityContextHolder.createEmptyContext());</div><div class="line">         SecurityContextHolder.getContext().setAuthentication(runAs);</div><div class="line"></div><div class="line">         <span class="comment">// need to revert to token.Authenticated post-invocation</span></div><div class="line">         <span class="keyword">return</span> <span class="keyword">new</span> InterceptorStatusToken(origCtx, <span class="keyword">true</span>, attributes, object);</div><div class="line">     &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p> For unauthorized request, <code>this.accessDecisionManager.decide(authenticated, object, attributes);</code> will throw the access denied exception.</p>
</li>
<li><p>ExceptionTranslationFilter caught the exception thrown in step 3, saves the origianl request, and triggers the authentication, i.e., the Entry point. Typically user will be redirected to login page or any other means of authentication.</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest req, ServletResponse res, FilterChain chain)</span></span></div><div class="line"><span class="function">        <span class="keyword">throws</span> IOException, ServletException </span>&#123;</div><div class="line">    HttpServletRequest request = (HttpServletRequest) req;</div><div class="line">    HttpServletResponse response = (HttpServletResponse) res;</div><div class="line"></div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        chain.doFilter(request, response);</div><div class="line"></div><div class="line">        logger.debug(<span class="string">"Chain processed normally"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">catch</span> (IOException ex) &#123;</div><div class="line">        <span class="keyword">throw</span> ex;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">catch</span> (Exception ex) &#123;</div><div class="line">        <span class="comment">// Try to extract a SpringSecurityException from the stacktrace</span></div><div class="line">        Throwable[] causeChain = throwableAnalyzer.determineCauseChain(ex);</div><div class="line">        RuntimeException ase = (AuthenticationException)</div><div class="line">                throwableAnalyzer.getFirstThrowableOfType(AuthenticationException.class, causeChain);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (ase == <span class="keyword">null</span>) &#123;</div><div class="line">            ase = (AccessDeniedException)throwableAnalyzer.getFirstThrowableOfType(AccessDeniedException.class, causeChain);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (ase != <span class="keyword">null</span>) &#123;</div><div class="line">            handleSpringSecurityException(request, response, chain, ase);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">// Rethrow ServletExceptions and RuntimeExceptions as-is</span></div><div class="line">            <span class="keyword">if</span> (ex <span class="keyword">instanceof</span> ServletException) &#123;</div><div class="line">                <span class="keyword">throw</span> (ServletException) ex;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (ex <span class="keyword">instanceof</span> RuntimeException) &#123;</div><div class="line">                <span class="keyword">throw</span> (RuntimeException) ex;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="comment">// Wrap other Exceptions. This shouldn't actually happen</span></div><div class="line">            <span class="comment">// as we've already covered all the possibilities for doFilter</span></div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(ex);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">handleSpringSecurityException</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain chain,</span></span></div><div class="line"><span class="function"><span class="params">        RuntimeException exception)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</div><div class="line">    <span class="keyword">if</span> (exception <span class="keyword">instanceof</span> AuthenticationException) &#123;</div><div class="line">        logger.debug(<span class="string">"Authentication exception occurred; redirecting to authentication entry point"</span>, exception);</div><div class="line"></div><div class="line">        sendStartAuthentication(request, response, chain, (AuthenticationException) exception);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (exception <span class="keyword">instanceof</span> AccessDeniedException) &#123;</div><div class="line">        <span class="keyword">if</span> (authenticationTrustResolver.isAnonymous(SecurityContextHolder.getContext().getAuthentication())) &#123;</div><div class="line">            logger.debug(<span class="string">"Access is denied (user is anonymous); redirecting to authentication entry point"</span>,</div><div class="line">                        exception);</div><div class="line"></div><div class="line">            sendStartAuthentication(request, response, chain, <span class="keyword">new</span> InsufficientAuthenticationException(</div><div class="line">                    <span class="string">"Full authentication is required to access this resource"</span>));</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> &#123;</div><div class="line">            logger.debug(<span class="string">"Access is denied (user is not anonymous); delegating to AccessDeniedHandler"</span>, exception);</div><div class="line"></div><div class="line">            accessDeniedHandler.handle(request, response, (AccessDeniedException) exception);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">sendStartAuthentication</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain chain,</span></span></div><div class="line"><span class="function"><span class="params">        AuthenticationException reason)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</div><div class="line">    <span class="comment">// SEC-112: Clear the SecurityContextHolder's Authentication, as the</span></div><div class="line">    <span class="comment">// existing Authentication is no longer considered valid</span></div><div class="line">    SecurityContextHolder.getContext().setAuthentication(<span class="keyword">null</span>);</div><div class="line">    requestCache.saveRequest(request, response);</div><div class="line">    logger.debug(<span class="string">"Calling Authentication entry point."</span>);</div><div class="line">    authenticationEntryPoint.commence(request, response, reason);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>The sucuritycontextholder will be cleared when request is served.</p>
</li>
<li><p>Then entry point is definitely unprotected resource, otherwise we created an infinite loop.</p>
</li>
<li><p>When user’s credentials are available, e.g., login form post request, the posted url is usually protected to trigger security chain. In case of spring login form, the url is <strong>/j_spring_security_check</strong>. SecurityContext, again is restored along the way, with AnonymousUserToken created in step 2.</p>
</li>
<li><p>UsernamePasswordAuthenticationFilter is the filter to handle basic authentication request. It inherits the dofilter method from AbastractAuthenticationProcessingFilter.</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest req, ServletResponse res, FilterChain chain)</span></span></div><div class="line"><span class="function">        <span class="keyword">throws</span> IOException, ServletException </span>&#123;</div><div class="line"></div><div class="line">    HttpServletRequest request = (HttpServletRequest) req;</div><div class="line">    HttpServletResponse response = (HttpServletResponse) res;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!requiresAuthentication(request, response)) &#123;</div><div class="line">        chain.doFilter(request, response);</div><div class="line"></div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</div><div class="line">        logger.debug(<span class="string">"Request is to process authentication"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    Authentication authResult;</div><div class="line"></div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        authResult = attemptAuthentication(request, response);</div><div class="line">        <span class="keyword">if</span> (authResult == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="comment">// return immediately as subclass has indicated that it hasn't completed authentication</span></div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        sessionStrategy.onAuthentication(authResult, request, response);</div><div class="line">    &#125; <span class="keyword">catch</span>(InternalAuthenticationServiceException failed) &#123;</div><div class="line">        logger.error(<span class="string">"An internal error occurred while trying to authenticate the user."</span>, failed);</div><div class="line">        unsuccessfulAuthentication(request, response, failed);</div><div class="line"></div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">catch</span> (AuthenticationException failed) &#123;</div><div class="line">        <span class="comment">// Authentication failed</span></div><div class="line">        unsuccessfulAuthentication(request, response, failed);</div><div class="line"></div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// Authentication success</span></div><div class="line">    <span class="keyword">if</span> (continueChainBeforeSuccessfulAuthentication) &#123;</div><div class="line">        chain.doFilter(request, response);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    successfulAuthentication(request, response, chain, authResult);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> attemptAuthentication method simply encapsulates the username &amp; password in one UsernamePasswordAuthenticationToken instance and then<br> passes to the configured authentication manager to authenticate. Again, spring secuirty keeps the flexibility of the customization of the authentication mansger.</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> Authentication <span class="title">attemptAuthentication</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</div><div class="line">    <span class="keyword">if</span> (postOnly &amp;&amp; !request.getMethod().equals(<span class="string">"POST"</span>)) &#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> AuthenticationServiceException(<span class="string">"Authentication method not supported: "</span> + request.getMethod());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    String username = obtainUsername(request);</div><div class="line">    String password = obtainPassword(request);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (username == <span class="keyword">null</span>) &#123;</div><div class="line">        username = <span class="string">""</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (password == <span class="keyword">null</span>) &#123;</div><div class="line">        password = <span class="string">""</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    username = username.trim();</div><div class="line"></div><div class="line">    UsernamePasswordAuthenticationToken authRequest = <span class="keyword">new</span> UsernamePasswordAuthenticationToken(username, password);</div><div class="line"></div><div class="line">    <span class="comment">// Allow subclasses to set the "details" property</span></div><div class="line">    setDetails(request, authRequest);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.getAuthenticationManager().authenticate(authRequest);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>If the authentication is successful, the token will be saved, success event will be published.</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">successfulAuthentication</span><span class="params">(HttpServletRequest request, HttpServletResponse response,</span></span></div><div class="line"><span class="function"><span class="params">        Authentication authResult)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</div><div class="line">        logger.debug(<span class="string">"Authentication success. Updating SecurityContextHolder to contain: "</span> + authResult);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    SecurityContextHolder.getContext().setAuthentication(authResult);</div><div class="line"></div><div class="line">    rememberMeServices.loginSuccess(request, response, authResult);</div><div class="line"></div><div class="line">    <span class="comment">// Fire event</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.eventPublisher != <span class="keyword">null</span>) &#123;</div><div class="line">        eventPublisher.publishEvent(<span class="keyword">new</span> InteractiveAuthenticationSuccessEvent(authResult, <span class="keyword">this</span>.getClass()));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    successHandler.onAuthenticationSuccess(request, response, authResult);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>Configured successhandler will be invoked. If unspecified, SavedRequestAwareAuthenticationSuccessHandler is the default success handler. It will restore the original request from cache and redirect.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAuthenticationSuccess</span><span class="params">(HttpServletRequest request, HttpServletResponse response,</span></span></div><div class="line"><span class="function"><span class="params">        Authentication authentication)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</div><div class="line">    SavedRequest savedRequest = requestCache.getRequest(request, response);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (savedRequest == <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">super</span>.onAuthenticationSuccess(request, response, authentication);</div><div class="line"></div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    String targetUrlParameter = getTargetUrlParameter();</div><div class="line">    <span class="keyword">if</span> (isAlwaysUseDefaultTargetUrl() || (targetUrlParameter != <span class="keyword">null</span> &amp;&amp; StringUtils.hasText(request.getParameter(targetUrlParameter)))) &#123;</div><div class="line">        requestCache.removeRequest(request, response);</div><div class="line">        <span class="keyword">super</span>.onAuthenticationSuccess(request, response, authentication);</div><div class="line"></div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    clearAuthenticationAttributes(request);</div><div class="line"></div><div class="line">    <span class="comment">// Use the DefaultSavedRequest URL</span></div><div class="line">    String targetUrl = savedRequest.getRedirectUrl();</div><div class="line">    logger.debug(<span class="string">"Redirecting to DefaultSavedRequest Url: "</span> + targetUrl);</div><div class="line">    getRedirectStrategy().sendRedirect(request, response, targetUrl);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>As always the secuirty context is cleared when request processing cycle is completed.</p>
</li>
</ol>
<p>At last, when browser redirects to the protected source, the authenticated token was restored, and this time it passes through the FilterSecuirtyIntecptor, user is happy to access secured resources, as illustrated by step 12-14.</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-08-16T16:00:00.000Z"><a href="/2015/08/17/SpringMVC-Modal-Track/">2015-08-17</a></time>
      
      
  
    <h1 class="title"><a href="/2015/08/17/SpringMVC-Modal-Track/">Tracking Modal Changes per Request in SpringMVC</a></h1>
  

    </header>
    <div class="entry">
      
        <p><img src="/images/springmvc_modelattr.png" alt=""></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-01-19T16:00:00.000Z"><a href="/2015/01/20/Git-Reset-Visualized-By-Gitk/">2015-01-20</a></time>
      
      
  
    <h1 class="title"><a href="/2015/01/20/Git-Reset-Visualized-By-Gitk/">Visualize Git Reset with Gitk</a></h1>
  

    </header>
    <div class="entry">
      
        <p>Git Reset is one of the most confusing git commands every git user has to cope with. Yet, once tamed, it’s so good a beast that you never want to abandon. To become a master of it, Let’s explore the dark secrets with gitk.</p>
<p>The initial working tree looks like this:</p>
<p><img src="/images/init_unstaged.png" alt=""></p>
<p>It’s formed by the following commits in order of time:   </p>
<ol>
<li>Created and committed an empty file <code>greet</code></li>
<li>Added one line “hello, git!” in <code>greet</code></li>
<li>Added file <code>bye</code></li>
</ol>
<p>Added one line “good night” in <code>bye</code> in my working tree and added empty file <code>morning</code>, only staged file morning. For comparison, let’s remember the snapshot below of the staged area(a.k.s Index):</p>
<p><img src="/images/init-staged.png" alt=""></p>
<p>Now, let’s try command <strong>git reset --soft HEAD~2</strong>, what had changed is illustrated below:</p>
<p><img src="/images/reset-soft.png" alt=""></p>
<p>Your working area is untouched, but the staged area had added the changes in commit 2 and commit 3. Also, the HEAD now points to the commit 1.</p>
<p>To compare, let’s restore to the initial state. And try command <strong>git reset --mixed HEAD~2</strong>, the result is the following:</p>
<p><img src="/images/reset-mixed.png" alt=""></p>
<p>Now it’s interesting, nothing was in staged area(in other words, the staged area is identical to the committed repository(a.k.a HEAD). Commit 2 and Commit 3 ended in your working area, <code>greet</code> appears as modified, <code>bye</code> untracked. Note that --mixed option is optional and is the default option for reset.<br>So far so good, we didn’t lose anything, we can always play around and commit later.</p>
<p>What about --hard option? Let’s learn it the <strong>hard</strong> way, :). After restoring to the init state, simply run <strong>git reset --hard HEAD~</strong>, Here’s the result:</p>
<p><img src="/images/reset-hard.png" alt=""></p>
<p>Boom!<br>You cleaned everything! Commit 2 and Commit 3 are gone, nothing retained in your working area, nor in the staged area. Don’t feel too sad, you could run <strong>git reflog</strong> to find the commit SHA1 hash that includes both commits. Then run <strong>git reset --hard {SHA1}</strong> again to restore to a closest state. But the uncommitted change to <code>bye</code> and new file <code>morning</code> are permanently gone. </p>
<p>Is that all? NO! Git allows us to specify a path in the command, but without options like soft, hard, or mixed. Run <strong>git reset HEAD~2 greet</strong> on initial tree state result in the following snapshots:</p>
<p><img src="/images/reset-file-staged.png" alt=""></p>
<p>You see, <code>morning</code> staged earlier  is still there, but the <code>greet</code> was restored to its state in Commit 1. Branch HEAD was still on Commit 3.</p>
<p><img src="/images/reset-file-unstaged.png" alt=""></p>
<p>The above picture shows the working area, the change to <code>bye</code> was untouched, but changes to <code>greet</code> in commit 2 was preserved. So the reseted file in target commit(HEAD~2 in this case) actually ends up in staged area. It’s a saf<br> on Commit 3.</p>
<p><img src="/images/reset-file-unstaged.png" alt=""></p>
<p>The above picture shows the working area, the change to <code>bye</code> was untouched, but changes to <code>greet</code> in commit 2 was preserved. So the reseted file in target commit(HEAD~2 in this case) actually ends up in staged area. It’s another safe command in your toolbox.</p>
<p>To sum up, it might be easier to think of it this way: <strong>--soft</strong> roughly means “touch”, while <strong>--hard</strong> corresponds to “override”.<br>In terms of depth, <strong>--soft</strong> softly touches the staged area only, <strong>--mixed</strong> overrides the staged area and softly touches the working area, while <strong>--hard</strong> override both hardly.<br>When it comes to safety, always think twice before applying <strong>--hard</strong> option.</p>
<p>TODO: add missing options</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




<nav id="pagination">
  
    <a href="/page/2/" class="alignleft prev">Prev</a>
  
  
    <a href="/page/4/" class="alignright next">Next</a>
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright">
  

  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/Algorithm/">Algorithm</a><small>12</small></li>
  
    <li><a href="/tags/Angular/">Angular</a><small>1</small></li>
  
    <li><a href="/tags/Git/">Git</a><small>3</small></li>
  
    <li><a href="/tags/Go/">Go</a><small>4</small></li>
  
    <li><a href="/tags/Java/">Java</a><small>13</small></li>
  
    <li><a href="/tags/Javascript/">Javascript</a><small>4</small></li>
  
    <li><a href="/tags/Jekyll/">Jekyll</a><small>1</small></li>
  
    <li><a href="/tags/Linked-List/">Linked List</a><small>2</small></li>
  
    <li><a href="/tags/Linux/">Linux</a><small>1</small></li>
  
    <li><a href="/tags/Maven/">Maven</a><small>1</small></li>
  
    <li><a href="/tags/Network/">Network</a><small>1</small></li>
  
    <li><a href="/tags/Python/">Python</a><small>3</small></li>
  
    <li><a href="/tags/Regex/">Regex</a><small>3</small></li>
  
    <li><a href="/tags/SSL/">SSL</a><small>1</small></li>
  
    <li><a href="/tags/Spring/">Spring</a><small>2</small></li>
  
    <li><a href="/tags/Spring-Security/">Spring Security</a><small>1</small></li>
  
    <li><a href="/tags/Tool/">Tool</a><small>1</small></li>
  
    <li><a href="/tags/Training/">Training</a><small>1</small></li>
  
    <li><a href="/tags/Web-Service/">Web Service</a><small>1</small></li>
  
    <li><a href="/tags/XPath/">XPath</a><small>1</small></li>
  
    <li><a href="/tags/XSL/">XSL</a><small>1</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2017 <a href="mailto:coolcoolericwzc@163.com">Zhenchao Wang </a>
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>